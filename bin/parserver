#!/usr/bin/env ruby
require 'rubygems'
require 'socket'
require 'biodiversity'          # Get sockets from stdlib
puts "Running parser service on port 4334"
parser = ScientificNameParser.new
server = TCPServer.open(4334)  # Socket to listen on port 4334
loop do                         # Servers run forever
  client = server.accept       # Wait for a client to connect
  while a = client.readline
    if ['end','exit','q', '.'].include? a.strip
      client.close
      break
    end
    client.puts parser.parse(a).to_json
  end
end

